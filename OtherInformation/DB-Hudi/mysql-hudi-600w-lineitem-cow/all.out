2021-12-23T10:06:39,856  [boraydata.tcm.DoIt    ] main INFO : 
================================== Source Config Info ==================================
	host:192.168.120.68
	port:3306
	username:'root'
	password:'MyNewPass4!'
	dataSourceType:MYSQL
	databasename:test_db
	tableName:lineitem
	url:jdbc:mysql://192.168.120.68:3306/test_db?useSSL=false

================================== Clone Config Info ==================================
	host:192.168.120.67
	port:10000
	username:'rapids'
	password:'rapids'
	dataSourceType:HUDI
	databasename:test_cdc_hudi
	tableName:lineitem_cow
	url:jdbc:hive2://192.168.120.67:10000/test_cdc_hudi


2021-12-23T10:06:39,864  [boraydata.tcm.DoIt    ] main INFO : Ready to get Source Table structure and information:MYSQL->lineitem
2021-12-23T10:06:40,159  [boraydata.tcm.DoIt    ] main INFO : >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> get Source Table info total time spent:295

2021-12-23T10:06:40,163  [boraydata.tcm.DoIt    ] main INFO : 
================================== Source Table Info ==================================
	DataSourceType:MYSQL
	CatalogName:def
	SchemaName:test_db
	TableName:lineitem
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ columns info ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	ColumnName=l_orderkey           DataType=int                  UdtType=int                  Position=1    CharMaxLength=0          NumericPrecisionM=10   NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=INT32
	ColumnName=L_PARTKEY            DataType=int                  UdtType=int                  Position=2    CharMaxLength=0          NumericPrecisionM=10   NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=INT32
	ColumnName=L_SUPPKEY            DataType=int                  UdtType=int                  Position=3    CharMaxLength=0          NumericPrecisionM=10   NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=INT32
	ColumnName=L_LINENUMBER         DataType=int                  UdtType=int                  Position=4    CharMaxLength=0          NumericPrecisionM=10   NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=INT32
	ColumnName=L_QUANTITY           DataType=decimal(15,2)        UdtType=decimal              Position=5    CharMaxLength=0          NumericPrecisionM=15   NumericPrecisionD=2    DatetimePrecision=0    tableCLoneManageType=DECIMAL
	ColumnName=L_EXTENDEDPRICE      DataType=decimal(15,2)        UdtType=decimal              Position=6    CharMaxLength=0          NumericPrecisionM=15   NumericPrecisionD=2    DatetimePrecision=0    tableCLoneManageType=DECIMAL
	ColumnName=L_DISCOUNT           DataType=decimal(15,2)        UdtType=decimal              Position=7    CharMaxLength=0          NumericPrecisionM=15   NumericPrecisionD=2    DatetimePrecision=0    tableCLoneManageType=DECIMAL
	ColumnName=L_TAX                DataType=decimal(15,2)        UdtType=decimal              Position=8    CharMaxLength=0          NumericPrecisionM=15   NumericPrecisionD=2    DatetimePrecision=0    tableCLoneManageType=DECIMAL
	ColumnName=L_RETURNFLAG         DataType=char(1)              UdtType=char                 Position=9    CharMaxLength=1          NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=STRING
	ColumnName=L_LINESTATUS         DataType=char(1)              UdtType=char                 Position=10   CharMaxLength=1          NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=STRING
	ColumnName=L_SHIPDATE           DataType=date                 UdtType=date                 Position=11   CharMaxLength=0          NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=DATE
	ColumnName=L_COMMITDATE         DataType=date                 UdtType=date                 Position=12   CharMaxLength=0          NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=DATE
	ColumnName=L_RECEIPTDATE        DataType=date                 UdtType=date                 Position=13   CharMaxLength=0          NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=DATE
	ColumnName=L_SHIPINSTRUCT       DataType=char(25)             UdtType=char                 Position=14   CharMaxLength=25         NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=STRING
	ColumnName=L_SHIPMODE           DataType=char(10)             UdtType=char                 Position=15   CharMaxLength=10         NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=STRING
	ColumnName=L_COMMENT            DataType=varchar(44)          UdtType=varchar              Position=16   CharMaxLength=44         NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=STRING
	ColumnName=id                   DataType=int                  UdtType=int                  Position=17   CharMaxLength=0          NumericPrecisionM=10   NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=INT32


2021-12-23T10:06:40,163  [boraydata.tcm.DoIt    ] main INFO : Ready to create Clone Table 'lineitem_cow' in HUDI
2021-12-23T10:06:40,163  [boraydata.tcm.DoIt    ] main INFO : >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> create Clone Table total time spent:0

2021-12-23T10:06:40,167  [boraydata.tcm.DoIt    ] main INFO : 
================================== Clone Table Info ==================================
	DataSourceType:MYSQL
	CatalogName:null
	SchemaName:null
	TableName:lineitem_cow
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ columns info ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	ColumnName=l_orderkey           DataType=int                  UdtType=int                  Position=1    CharMaxLength=0          NumericPrecisionM=10   NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=INT32
	ColumnName=L_PARTKEY            DataType=int                  UdtType=int                  Position=2    CharMaxLength=0          NumericPrecisionM=10   NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=INT32
	ColumnName=L_SUPPKEY            DataType=int                  UdtType=int                  Position=3    CharMaxLength=0          NumericPrecisionM=10   NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=INT32
	ColumnName=L_LINENUMBER         DataType=int                  UdtType=int                  Position=4    CharMaxLength=0          NumericPrecisionM=10   NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=INT32
	ColumnName=L_QUANTITY           DataType=decimal(15,2)        UdtType=decimal              Position=5    CharMaxLength=0          NumericPrecisionM=15   NumericPrecisionD=2    DatetimePrecision=0    tableCLoneManageType=DECIMAL
	ColumnName=L_EXTENDEDPRICE      DataType=decimal(15,2)        UdtType=decimal              Position=6    CharMaxLength=0          NumericPrecisionM=15   NumericPrecisionD=2    DatetimePrecision=0    tableCLoneManageType=DECIMAL
	ColumnName=L_DISCOUNT           DataType=decimal(15,2)        UdtType=decimal              Position=7    CharMaxLength=0          NumericPrecisionM=15   NumericPrecisionD=2    DatetimePrecision=0    tableCLoneManageType=DECIMAL
	ColumnName=L_TAX                DataType=decimal(15,2)        UdtType=decimal              Position=8    CharMaxLength=0          NumericPrecisionM=15   NumericPrecisionD=2    DatetimePrecision=0    tableCLoneManageType=DECIMAL
	ColumnName=L_RETURNFLAG         DataType=char(1)              UdtType=char                 Position=9    CharMaxLength=1          NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=STRING
	ColumnName=L_LINESTATUS         DataType=char(1)              UdtType=char                 Position=10   CharMaxLength=1          NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=STRING
	ColumnName=L_SHIPDATE           DataType=date                 UdtType=date                 Position=11   CharMaxLength=0          NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=DATE
	ColumnName=L_COMMITDATE         DataType=date                 UdtType=date                 Position=12   CharMaxLength=0          NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=DATE
	ColumnName=L_RECEIPTDATE        DataType=date                 UdtType=date                 Position=13   CharMaxLength=0          NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=DATE
	ColumnName=L_SHIPINSTRUCT       DataType=char(25)             UdtType=char                 Position=14   CharMaxLength=25         NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=STRING
	ColumnName=L_SHIPMODE           DataType=char(10)             UdtType=char                 Position=15   CharMaxLength=10         NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=STRING
	ColumnName=L_COMMENT            DataType=varchar(44)          UdtType=varchar              Position=16   CharMaxLength=44         NumericPrecisionM=0    NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=STRING
	ColumnName=id                   DataType=int                  UdtType=int                  Position=17   CharMaxLength=0          NumericPrecisionM=10   NumericPrecisionD=0    DatetimePrecision=0    tableCLoneManageType=INT32


2021-12-23T10:06:40,168  [boraydata.tcm.DoIt    ] main INFO : Read to Export Source Table data in CSV.
2021-12-23T10:06:40,179  [tcm.syncing.CommandExecutor] main INFO : 			!!!!!!!!!!!!!!!!!!!!!!!!!! Shell Path :./TCM-Temp/Export_from_MYSQL_lineitem.sh !!!!!!!!!!!!!!!!!!!!!!!!!!!
2021-12-23T10:06:40,434  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :[33mWARNING: [0mUsing a password on the command line interface can be insecure.
2021-12-23T10:06:40,439  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Initializing...
2021-12-23T10:06:40,465  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Initializing - done
2021-12-23T10:06:40,465  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Gathering information...
2021-12-23T10:06:40,485  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Gathering information - done
2021-12-23T10:06:40,485  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Writing table metadata...
2021-12-23T10:06:40,486  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Running data dump using 1 thread.
2021-12-23T10:06:40,486  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Dumping data...
2021-12-23T10:06:40,741  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Writing table metadata - done
2021-12-23T10:06:40,742  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Starting data dump
2021-12-23T10:06:57,722  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Dumping data - done
2021-12-23T10:06:57,722  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Dump duration: 00:00:17s
2021-12-23T10:06:57,722  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Total duration: 00:00:17s
2021-12-23T10:06:57,722  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Data size: 914.78 MB
2021-12-23T10:06:57,722  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Rows written: 6001215
2021-12-23T10:06:57,722  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Bytes written: 914.78 MB
2021-12-23T10:06:57,722  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Average throughput: 53.07 MB/s
2021-12-23T10:06:57,723  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :
2021-12-23T10:06:57,723  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :The dump can be loaded using:
2021-12-23T10:06:57,723  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :util.importTable("./TCM-Temp/Export_from_MYSQL_lineitem.csv", {
2021-12-23T10:06:57,723  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :    "characterSet": "utf8mb4",
2021-12-23T10:06:57,723  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :    "fieldsEnclosedBy": "\"",
2021-12-23T10:06:57,723  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :    "fieldsEscapedBy": "\\",
2021-12-23T10:06:57,723  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :    "fieldsOptionallyEnclosed": true,
2021-12-23T10:06:57,723  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :    "fieldsTerminatedBy": "|",
2021-12-23T10:06:57,723  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :    "linesTerminatedBy": "\n",
2021-12-23T10:06:57,723  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :    "schema": "test_db",
2021-12-23T10:06:57,724  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :    "table": "lineitem"
2021-12-23T10:06:57,724  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :})
2021-12-23T10:06:57,761  [boraydata.tcm.DoIt    ] main INFO : *********************************** EXPORT INFO ***********************************

export MYSQL:lineitem in ./TCM-Temp/Export_from_MYSQL_lineitem.csv script:'./TCM-Temp/Export_from_MYSQL_lineitem.sh'

2021-12-23T10:06:57,761  [boraydata.tcm.DoIt    ] main INFO : >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> export data total time spent:17594


2021-12-23T10:06:57,762  [boraydata.tcm.DoIt    ] main INFO : Read to Load CSV data in Clone Table.
2021-12-23T10:06:57,765  [tcm.syncing.CommandExecutor] main INFO : 			!!!!!!!!!!!!!!!!!!!!!!!!!! Shell Path :./TCM-Temp/Load_to_HUDI_lineitem_cow.sh !!!!!!!!!!!!!!!!!!!!!!!!!!!
2021-12-23T10:08:57,565  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Spark context Web UI available at http://cdc1:4040
2021-12-23T10:08:57,565  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Spark context available as 'sc' (master = yarn, app id = application_1640249124969_0009).
2021-12-23T10:08:57,566  [tcm.syncing.CommandExecutor] main INFO : 			Shell Shell :Spark session available as 'spark'.
2021-12-23T10:11:18,115  [boraydata.tcm.DoIt    ] main INFO : *********************************** LOAD INFO ***********************************

load data in HUDI:lineitem_cow script:'./TCM-Temp/Load_to_HUDI_lineitem_cow.sh'

2021-12-23T10:11:18,116  [boraydata.tcm.DoIt    ] main INFO : >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> load data total time spent:260352
2021-12-23T10:11:18,117  [boraydata.tcm.DoIt    ] main INFO : >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> Mapping Table and Syncing TableData table time:278241 <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
2021-12-23T10:11:18,117  [boraydata.tcm.DoIt    ] main INFO : 




2021-12-23T10:11:18,117  [boraydata.tcm.DoIt    ] main INFO : ------------------------------------------------------------------------------------- Export_from_MYSQL_lineitem.sh -------------------------------------------------------------------------------------

mysqlsh -h 192.168.120.68 -P 3306 -uroot -pMyNewPass4! --database test_db -e "util.exportTable('lineitem','./TCM-Temp/Export_from_MYSQL_lineitem.csv',{linesTerminatedBy:'\n',fieldsTerminatedBy:'|',fieldsOptionallyEnclosed:true,fieldsEnclosedBy:'\"',fieldsEscapedBy:'\\\'})" 2>&1


2021-12-23T10:11:18,118  [boraydata.tcm.DoIt    ] main INFO : ------------------------------------------------------------------------------------- Load_CSV_to_hudi_COPY_ON_WRITE.scala -------------------------------------------------------------------------------------

import scala.collection.JavaConversions._
import org.apache.spark.sql.SaveMode._
import org.apache.hudi.DataSourceReadOptions._
import org.apache.hudi.DataSourceWriteOptions._
import org.apache.hudi.config.HoodieWriteConfig._
import org.apache.spark.sql.types._

val schema = new StructType().add("l_orderkey",IntegerType).add("L_PARTKEY",IntegerType).add("L_SUPPKEY",IntegerType).add("L_LINENUMBER",IntegerType).add("L_QUANTITY",StringType).add("L_EXTENDEDPRICE",StringType).add("L_DISCOUNT",StringType).add("L_TAX",StringType).add("L_RETURNFLAG",StringType).add("L_LINESTATUS",StringType).add("L_SHIPDATE",DateType).add("L_COMMITDATE",DateType).add("L_RECEIPTDATE",DateType).add("L_SHIPINSTRUCT",StringType).add("L_SHIPMODE",StringType).add("L_COMMENT",StringType).add("id",IntegerType);

val df = spark.read.schema(schema).option("delimiter", "|").option("escape", "\\").option("quote", "\"").csv("hdfs:///HudiTest/Export_from_MYSQL_lineitem.csv").withColumn("_hoodie_ts",lit(null).cast(TimestampType)).withColumn("_hoodie_date",lit(null).cast(StringType));

df.write.format("org.apache.hudi").option("hoodie.datasource.write.operation","insert").option("hoodie.datasource.write.table.type","COPY_ON_WRITE").option("hoodie.embed.timeline.server",false).option("hoodie.table.name","lineitem_cow").option("hoodie.datasource.write.recordkey.field","id").option("hoodie.datasource.write.partitionpath.field","_hoodie_date").option("hoodie.datasource.hive_sync.jdbcurl", "jdbc:hive2://192.168.120.67:10000/test_cdc_hudi").option("hoodie.datasource.hive_sync.database", "test_cdc_hudi").option("hoodie.datasource.hive_sync.username","rapids").option("hoodie.datasource.hive_sync.password","rapids").option("hoodie.datasource.hive_sync.enable",true).option("hoodie.datasource.hive_sync.table","lineitem_cow").option("hoodie.datasource.hive_sync.partition_fields","_hoodie_date").option("hoodie.datasource.hive_sync.partition_extractor_class","org.apache.hudi.hive.MultiPartKeysValueExtractor").option("hoodie.datasource.hive_sync.mode","hms").mode(Append).save("/HudiTest/lineitem_cow");

System.exit(0);

2021-12-23T10:11:18,119  [boraydata.tcm.DoIt    ] main INFO : ------------------------------------------------------------------------------------- Load_to_HUDI_lineitem_cow.sh -------------------------------------------------------------------------------------

hdfs dfs -mkdir -p hdfs:///HudiTest/
hdfs dfs -rm -r /HudiTest/lineitem_cow
time hdfs dfs -put -f ./TCM-Temp/Export_from_MYSQL_lineitem.csv hdfs:///HudiTest/

time spark-shell --jars /opt/CDC/spark/jars/hudi-spark-bundle_2.11-0.8.0.jar --driver-class-path $HADOOP_CONF_DIR --packages org.apache.spark:spark-avro_2.11:2.4.4 --master yarn --deploy-mode client --driver-memory 4g --driver-cores 1 --num-executors 10 --executor-memory 4g --executor-cores 2 --conf spark.default.parallelism=40  -i ./TCM-Temp/Load_CSV_to_hudi_COPY_ON_WRITE.scala

2021-12-23T10:11:18,119  [boraydata.tcm.DoIt    ] main INFO : ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
